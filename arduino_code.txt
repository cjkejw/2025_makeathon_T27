#define BUZZER_PIN 3  // Pin connected to the buzzer
#define LED_PIN 4     // Pin connected to the LED

void setup() {
  pinMode(BUZZER_PIN, OUTPUT);
  pinMode(LED_PIN, OUTPUT);
  Serial.begin(9600);  // Start Serial communication
}

void loop() {
  if (Serial.available() > 0) {
    char signal = Serial.read();  // Read data from Python

    if (signal == '1') {
      // Human detected - activate the buzzer
      digitalWrite(LED_PIN, LOW); // Ensure LED is OFF for human detection
      for (int i = 0; i < 20; i++) {  // Loop for 20 fast buzz cycles
        tone(BUZZER_PIN, 5000);  // Generate a 5kHz tone
        delay(20);               // ON for 20ms

        // Check if the signal has changed to '0' to stop immediately
        if (Serial.available() > 0 && Serial.read() == '0') {
          noTone(BUZZER_PIN);        // Turn off the buzzer
          break;                    // Exit the loop
        }

        noTone(BUZZER_PIN);  // Turn off the tone
        delay(20);           // OFF for 20ms
      }
    } else if (signal == '2') {
      // Motion detected - activate the LED
      digitalWrite(LED_PIN, HIGH);
      noTone(BUZZER_PIN);  // Ensure the buzzer is OFF for motion detection
    } else if (signal == '0') {
      // No detection - turn everything OFF
      noTone(BUZZER_PIN);         // Ensure the buzzer is OFF
      digitalWrite(LED_PIN, LOW); // Ensure the LED is OFF
    }
  }
}
